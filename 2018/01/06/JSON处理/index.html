<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JSON处理 | glamor的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Json处理go语言内建对JSON的支持，使用Go语言内置的encoding/json标准库，开发者可以轻松使用Go程序生成和解析Json格式数据。">
<meta name="keywords" content="golang,编程">
<meta property="og:type" content="article">
<meta property="og:title" content="JSON处理">
<meta property="og:url" content="http://www.cmustarc.com/2018/01/06/JSON处理/index.html">
<meta property="og:site_name" content="glamor的博客">
<meta property="og:description" content="Json处理go语言内建对JSON的支持，使用Go语言内置的encoding/json标准库，开发者可以轻松使用Go程序生成和解析Json格式数据。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-01-06T14:13:45.788Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JSON处理">
<meta name="twitter:description" content="Json处理go语言内建对JSON的支持，使用Go语言内置的encoding/json标准库，开发者可以轻松使用Go程序生成和解析Json格式数据。">
  
    <link rel="alternative" href="/atom.xml" title="glamor的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">glamor</a></h1>
        </hgroup>

        
        <p class="header-subtitle">莫等闲，白了少年头空悲切...</p>
        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/categories/python">人生苦短</a></li>
                        
                            <li><a href="/categories/Web安全">安全海洋</a></li>
                        
                            <li><a href="/categories/notes">随笔</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="mailto:root@cmustard.com" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/cmustard06" title="github">github</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/TCP-IP/" style="font-size: 10px;">TCP/IP</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/golang/" style="font-size: 17.5px;">golang</a> <a href="/tags/importlib/" style="font-size: 10px;">importlib</a> <a href="/tags/poc/" style="font-size: 12.5px;">poc</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/python3/" style="font-size: 12.5px;">python3</a> <a href="/tags/sql注入/" style="font-size: 10px;">sql注入</a> <a href="/tags/struct/" style="font-size: 10px;">struct</a> <a href="/tags/struts/" style="font-size: 10px;">struts</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/tcp-ip/" style="font-size: 10px;">tcp/ip</a> <a href="/tags/windows命令/" style="font-size: 10px;">windows命令</a> <a href="/tags/事件驱动/" style="font-size: 10px;">事件驱动</a> <a href="/tags/代理/" style="font-size: 10px;">代理</a> <a href="/tags/博客/" style="font-size: 10px;">博客</a> <a href="/tags/基础/" style="font-size: 15px;">基础</a> <a href="/tags/并发/" style="font-size: 10px;">并发</a> <a href="/tags/异步IO/" style="font-size: 10px;">异步IO</a> <a href="/tags/正则表达式/" style="font-size: 10px;">正则表达式</a> <a href="/tags/漏扫/" style="font-size: 12.5px;">漏扫</a> <a href="/tags/爬虫/" style="font-size: 10px;">爬虫</a> <a href="/tags/科学上网/" style="font-size: 10px;">科学上网</a> <a href="/tags/系统/" style="font-size: 10px;">系统</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/编程语言/" style="font-size: 12.5px;">编程语言</a> <a href="/tags/网络/" style="font-size: 12.5px;">网络</a> <a href="/tags/网络基础知识/" style="font-size: 10px;">网络基础知识</a> <a href="/tags/网络编程/" style="font-size: 10px;">网络编程</a> <a href="/tags/集合/" style="font-size: 10px;">集合</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.dmmjy9.top">dmmjy9</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">glamor</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">glamor</a></h1>
            </hgroup>
            
            <p class="header-subtitle">莫等闲，白了少年头空悲切...</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/categories/python">人生苦短</a></li>
                
                    <li><a href="/categories/Web安全">安全海洋</a></li>
                
                    <li><a href="/categories/notes">随笔</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="mailto:root@cmustard.com" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/cmustard06" title="github">github</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-JSON处理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/01/06/JSON处理/" class="article-date">
      <time datetime="2018-01-06T14:13:45.788Z" itemprop="datePublished">2018-01-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JSON处理
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/notes/">notes</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/golang/">golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/编程/">编程</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="Json处理"><a href="#Json处理" class="headerlink" title="Json处理"></a>Json处理</h1><p>go语言内建对JSON的支持，使用Go语言内置的<code>encoding/json</code>标准库，开发者可以轻松使用Go程序生成和解析Json格式数据。<br><a id="more"></a></p>
<h1 id="编码为Json格式"><a href="#编码为Json格式" class="headerlink" title="编码为Json格式"></a>编码为Json格式</h1><p>使用<code>json.Marshal()</code>函数可以对一组数据进行Json格式的编码。<code>json.Marshal()</code>函数声明如下<br><code>func Marshal(v interface{}) ([]byte,error)</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">import(</div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">//定义一个类型</div><div class="line"><span class="built_in">type</span> Book struct&#123;</div><div class="line">	Title string</div><div class="line">	Authors []string</div><div class="line">	Publisher string</div><div class="line">	IsPublised bool</div><div class="line">	Price float64</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>()&#123;</div><div class="line">	//初始化并创建一个Book类型的变量</div><div class="line">	gobool := Book&#123;</div><div class="line">		<span class="string">"Go语言编程"</span>,[]string&#123;<span class="string">"cmustard"</span>,<span class="string">"glamor"</span>,<span class="string">"dmmjy9"</span>&#125;,</div><div class="line">		<span class="string">"glamor.site"</span>,</div><div class="line">		<span class="literal">true</span>,</div><div class="line">		9.99,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(gobool)</div><div class="line">	//json编码</div><div class="line">	b,_ := json.Marshal(gobool) //如果编码成功，err将被赋值为nil，，变量b将会是一个进行Json格式化之后的[]byte类型</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>b的值为<code>[123 34 84 105 116 108 101 34 58 34 71 111 232 175 173 232 168 128 231 188 150 231 168 139 34 44 34 65 117 116 104 111 114 115 34 58 91 34 99 109 117 115 116 97 114 100 34 44 34 103 108 97 109 111 114 34 44 34 100 109 109 106 121 57 34 93 44 34 80 117 98 108 105 115 104 101 114 34 58 34 103 108 97 109 111 114 46 115 105 116 101 34 44 34 73 115 80 117 98 108 105 115 101 100 34 58 116 114 117 101 44 34 80 114 105 99 101 34 58 57 46 57 57 125]</code><br>当我们调用<code>json.Marshal(gobool)</code>语句的时候，会递归遍历gobool对象，如果发现gobool这个数据结构实现了<code>json.Marshaler</code>接口并且包含有效的值，<code>Marshal()</code>就会调用其<code>MarshalJSON()</code>方法将数据结构生成JSON格式的文本<br>注意：<strong>go语言的大多数数据类型都可以转化成有效的JSON文本，但channel，complex和函数这几种类型除外</strong><br>在go语言中，JSON转化前后的数据类型映射如下：</p>
<ul>
<li>布尔类型转换为json类型之后还是bool类型</li>
<li>浮点型和整型都被转化为json里面的常规数字</li>
<li>字符串将以utf-8编码转化输出为Unicode字符集的字符串，特殊字符比如&lt;将会被转义为<br>u003c</li>
<li>数组和切片会转化为json里面的数组，但是[]byte类型的值将会被转化为Base64编码后的字符串，切片类型的0值将会被转化为null</li>
<li>结构体会转化为json对象，并且只要结构体里边<strong>以大写字母开头</strong>的<strong>可被导出</strong>的字段才会被转化输出，而这些可导出的字段会作为JSON对象的字符串索引</li>
<li>转化一个map类型的数据结构时，该数据的类型必须是<code>map[string] T</code>(T可以是json包支持的任意数据类型)<h1 id="解码JSON数据"><a href="#解码JSON数据" class="headerlink" title="解码JSON数据"></a>解码JSON数据</h1>可以使用<code>json.Unmarshal()</code>函数将JSON格式的文本解码为go语言中预期的数据结构。<br><code>func Unmarshal(data []byte,, v interface{}) error</code><br>第一个参数是输入，即JSON格式的比特序列，第二个参数表示目标输出容器，用于存放解码后的值</li>
</ul>
<p>要解码一段Json数据，<strong>首先需要创建一个目标类型的实例对象</strong>，用于存放解码后的值<br><code>var book Book</code><br>然后调用<code>json.Unmarshal()</code>函数<br><code>err := json.Unmarshal(b, &amp;book)</code>  <strong>由于没有返回值，所以想要改变book的值，需要传入book变量的地址</strong><br>如果b是一个有效的Json数据而且和book结构能够对应起来，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var book Book</div><div class="line">json.Unmarshal(b,&amp;book)</div><div class="line">fmt.Println(book)</div><div class="line">-----------</div><div class="line">&#123;Go语言编程 [cmustard glamor dmmjy9] glamor.site <span class="literal">true</span> 9.99&#125;</div></pre></td></tr></table></figure></p>
<p>go如何将一个解码后值关联到数据结构的相应字段<br><code>json.Unmarshal()</code>函数会根据一个约定的顺序查找目标结构中的字段，如果找到一个即发生匹配，假设一个json对象有一个名为Foo的索引，查找过程如下</p>
<ul>
<li>一个包含Foo标签的字段</li>
<li>一个名为Foo的字段</li>
<li>一个名为Foo或者除了首字母其他字母不区分大小写的名为Foo的字段<br><strong>这些字段必须为首字母大写且能够被导出的字段</strong><br>如果json中的字段在go目标类型中不存在时，<code>json.Unmarshal()</code>函数在解码过程中会丢弃该字段。比如<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//如果结构无法相互对应</div><div class="line"></div><div class="line">bb := []byte(`&#123;<span class="string">"Title"</span>:<span class="string">"Go语言编程"</span>,<span class="string">"Sales"</span>:10000&#125;`) //``代表内部是原始字符串</div><div class="line">var gobook Book</div><div class="line">err := json.Unmarshal(bb,&amp;gobook)</div><div class="line">fmt.Println(err)</div><div class="line">fmt.Println(gobook)//&#123;Go语言编程 []  <span class="literal">false</span> 0&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>由于Sales在Book类型中没有定义，所以会被忽略。<br>上面这个都是我们知道该json类型原数据结构的情况下所做的工作，假如我们不知道原数据结构呢，怎么还原？</p>
<h1 id="解码未知结构的JSON类型"><a href="#解码未知结构的JSON类型" class="headerlink" title="解码未知结构的JSON类型"></a>解码未知结构的JSON类型</h1><p>使用空接口来解码接受未知数据结构的json对象，因为<strong>空接口是通用类型</strong><br>在解码JSON数据的过程中，JSON数据里边的元素类型将做如下转换</p>
<ul>
<li>json中布尔类型转换为go语言中的布尔</li>
<li>数值会被转化成go语言中的float64类型’</li>
<li>字符串转化后还是string类型</li>
<li>json数组会转化为[]interface{}</li>
<li>json对象会转化为map[string]interface{}</li>
<li>null值会转化为nil<br>在go语言标准库中允许使用<code>map[string] interface{}</code>和<code>[]interface{}</code>类型的值来存放未知结构的json对象和数组。<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">import(</div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">//定义一个类型</div><div class="line"><span class="built_in">type</span> Book struct&#123;</div><div class="line">	Title string</div><div class="line">	Authors []string</div><div class="line">	Publisher string</div><div class="line">	IsPublised bool</div><div class="line">	Price float64</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>()&#123;</div><div class="line">	//初始化并创建一个Book类型的变量</div><div class="line">	gobool := Book&#123;</div><div class="line">		<span class="string">"Go语言编程"</span>,[]string&#123;<span class="string">"cmustard"</span>,<span class="string">"glamor"</span>,<span class="string">"dmmjy9"</span>&#125;,</div><div class="line">		<span class="string">"glamor.site"</span>,</div><div class="line">		<span class="literal">true</span>,</div><div class="line">		9.99,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(gobool)</div><div class="line">	//json编码</div><div class="line">	b,_ := json.Marshal(gobool)</div><div class="line">	fmt.Println(b)</div><div class="line"></div><div class="line">	//定义一个空接口</div><div class="line">	var r interface&#123;&#125;</div><div class="line">	err := json.Unmarshal(b,&amp;r)</div><div class="line">	fmt.Println(r)</div><div class="line">	fmt.Println()</div><div class="line">&#125;</div><div class="line">--------------------------</div><div class="line">map[Publisher:glamor.site IsPublised:<span class="literal">true</span> Price:9.99 Title:Go语言编程 Authors:[cmustard glamor dmmjy9]]</div></pre></td></tr></table></figure>
</li>
</ul>
<p>要访问解码后的数据，需要先判断目标结构是否为预期的数据类型<br><code>gobook,ok:= r.(map[string]interface{})</code><br>通过for循环搭配range语句一一访问解码后的目标数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import(</div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">//定义一个类型</div><div class="line"><span class="built_in">type</span> Book struct&#123;</div><div class="line">	Title string</div><div class="line">	Authors []string</div><div class="line">	Publisher string</div><div class="line">	IsPublised bool</div><div class="line">	Price float64</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>()&#123;</div><div class="line">	//初始化并创建一个Book类型的变量</div><div class="line">	gobool := Book&#123;</div><div class="line">		<span class="string">"Go语言编程"</span>,[]string&#123;<span class="string">"cmustard"</span>,<span class="string">"glamor"</span>,<span class="string">"dmmjy9"</span>&#125;,</div><div class="line">		<span class="string">"glamor.site"</span>,</div><div class="line">		<span class="literal">true</span>,</div><div class="line">		9.99,</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	fmt.Println(gobool)</div><div class="line">	//json编码</div><div class="line">	b,_ := json.Marshal(gobool)</div><div class="line">	fmt.Println(b)</div><div class="line">	//json解码</div><div class="line">	var book Book</div><div class="line">	json.Unmarshal(b,&amp;book)</div><div class="line">	fmt.Println(book)</div><div class="line"></div><div class="line">	//定义一个空接口</div><div class="line">	var r interface&#123;&#125;</div><div class="line">	_ = json.Unmarshal(b,&amp;r)</div><div class="line">	fmt.Println(r)</div><div class="line">	fmt.Println()</div><div class="line">	gobook,ok := r.(map[string]interface&#123;&#125;)</div><div class="line">	fmt.Println(ok)</div><div class="line">	<span class="keyword">if</span> ok&#123;</div><div class="line">		<span class="keyword">for</span> k,v:=range gobook&#123;</div><div class="line">			switch v2 := v.(<span class="built_in">type</span>)&#123;</div><div class="line">			<span class="keyword">case</span> string:</div><div class="line">				fmt.Println(k,<span class="string">"is string"</span>,v2) //Title is string Go语言编程,Publisher is string glamor.site</div><div class="line">			<span class="keyword">case</span> int:</div><div class="line">				fmt.Println(k,<span class="string">"is int"</span>,v2)</div><div class="line">			<span class="keyword">case</span> bool:</div><div class="line">				fmt.Println(k,<span class="string">"is bool"</span>,v2) //IsPublised is bool <span class="literal">true</span></div><div class="line">			<span class="keyword">case</span> []interface&#123;&#125;:</div><div class="line">				fmt.Println(k,<span class="string">"is an array"</span>,v2) //Authors is an array [cmustard glamor dmmjy9]</div><div class="line">				<span class="keyword">for</span> i,iv :=range v2&#123;  //不能直接使用v的原因是v一个接口，不是数组 var v interface&#123;&#125;</div><div class="line">					fmt.Println(i,iv)</div><div class="line">				&#125;</div><div class="line">			default:</div><div class="line">				fmt.Println(k,<span class="string">"is anthor type not handle yet"</span>) //Price is anthor <span class="built_in">type</span> not handle yet</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">-----------------</div><div class="line"><span class="literal">true</span></div><div class="line">Title is string Go语言编程</div><div class="line">Authors is an array [cmustard glamor dmmjy9]</div><div class="line">0 cmustard</div><div class="line">1 glamor</div><div class="line">2 dmmjy9</div><div class="line">Publisher is string glamor.site</div><div class="line">IsPublised is bool <span class="literal">true</span></div><div class="line">Price is anthor <span class="built_in">type</span> not handle yet</div></pre></td></tr></table></figure></p>
<h1 id="JSON的流式读写"><a href="#JSON的流式读写" class="headerlink" title="JSON的流式读写"></a>JSON的流式读写</h1><p>go中的json包还提供了Decoder和Encoder两个类型，用于支持json数据的流式读写。并提供了<code>NewDecoder()</code>和<code>NewEncoder()</code>两个函数<br><code>func NewDecoder(r io.Reader) *Decoder</code><br><code>func NewEncoder(w io.Write) *Encoder</code><br>从标准输入流中读取json数据，然后将其解码，但只保留Title字段，在写入到输入到标准输出流中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import(</div><div class="line">	<span class="string">"encoding/json"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"log"</span></div><div class="line">)</div><div class="line"></div><div class="line">func <span class="function"><span class="title">main</span></span>()&#123;</div><div class="line">	dec := json.NewDecoder(os.Stdin)  //从标准输入流中读取数据</div><div class="line">	enc := json.NewEncoder(os.Stdout) // 将数据写入到标准输出流中</div><div class="line">	<span class="keyword">for</span>&#123;</div><div class="line">		var v map[string] interface&#123;&#125;</div><div class="line">		<span class="keyword">if</span> err:=dec.Decode(&amp;v);err!=nil&#123;  //解数据流中的数据并将数据存储在v中</div><div class="line">			log.Println(err)</div><div class="line">			<span class="built_in">return</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">for</span> k:=range v&#123;</div><div class="line">			<span class="keyword">if</span> k!=<span class="string">"Title"</span>&#123;</div><div class="line">				delete(v,k)</div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> err:=enc.Encode(&amp;v);err!=nil&#123; ////将v的json编码写入到流中</div><div class="line">			log.Println(err)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/01/06/JSON处理/">JSON处理</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 glamor 的个人博客">glamor</a></p>
        <p><span>发布时间:</span>2018年01月06日 - 22时13分</p>
        <p><span>最后更新:</span>2018年01月06日 - 09时13分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/01/06/JSON处理/" title="JSON处理">http://www.cmustarc.com/2018/01/06/JSON处理/</a>
            <span class="copy-path" data-clipboard-text="原文: http://www.cmustarc.com/2018/01/06/JSON处理/　　作者: glamor" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2018/01/07/加密/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          加密
        
      </div>
    </a>
  
  
    <a href="/2018/01/03/网络编程/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">网络编程</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Json处理"><span class="toc-number">1.</span> <span class="toc-text">Json处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编码为Json格式"><span class="toc-number">2.</span> <span class="toc-text">编码为Json格式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解码JSON数据"><span class="toc-number">3.</span> <span class="toc-text">解码JSON数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解码未知结构的JSON类型"><span class="toc-number">4.</span> <span class="toc-text">解码未知结构的JSON类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSON的流式读写"><span class="toc-number">5.</span> <span class="toc-text">JSON的流式读写</span></a></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/01/07/加密/" title="上一篇: 加密">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2018/01/03/网络编程/" title="下一篇: 网络编程">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/05/28/python-importlib/">importlib动态加载模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/某扫描器/">某扫描器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/惊蛰漏洞扫描平台分析/">惊蛰漏洞扫描平台分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/07/加密/">加密</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/06/JSON处理/">JSON处理</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/03/网络编程/">网络编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/02/windows采用命令/">常用的windows命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/31/byte与rune/">rune与byte</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/28/数组与字典/">数组与数组切片</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/15/Python3笔记/">Python3 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/03/python基础/">python基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/07/数据链路层/">数据链路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/01/网络基础/">网络基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/01/tcp-ip简介/">tcp/ip简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/24/HTMLParser模块/">HTMLParser模块</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/23/SQL注入/">SQL注入整理(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/列表/">列表</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/19/偏函数/">偏函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/18/with上下文管理器/">上下文管理器与with语句</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/v2ray/">v2ray 配置文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/socket-python/">socket编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/28/正则表达式/">正则表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/15/s2-053/">S2-053</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/golang流程控制/">流程控制</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/10/Strut2 常见POC/">Struts2 常见POC收集和整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/论事件驱动与异步IO/">论事件驱动与异步IO[转]</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/并发编程/">并发编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/Python常用模块2/">python常用模块(2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/Python常用模块/">python常用模块(1)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/python TCP代理/">python TCP代理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/hexo+github+nginx VPS搭建博客/">hexo+github+nginx vps搭建博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/go语言初识/">初识go语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/goroutine与调度器/">goroutine与调度器[转]</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2018 glamor
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >道士到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>